---
import { Image } from "astro:assets";
import economicaAdministrativa from "@/assets/imagenes/cards_area_estudios/económico-administrativa.webp";
import cienciasSociales from "@/assets/imagenes/cards_area_estudios/ciencias-sociales.webp";
import disenoArtes from "@/assets/imagenes/cards_area_estudios/diseño-artes.webp";
import ingenieria from "@/assets/imagenes/cards_area_estudios/ingenieria.webp";

const areasAcademicas = [
  {
    nombre: "Negocios y Administrativas",
    descripcion:
      "Lidera con visión estratégica y gestión eficiente en el mundo empresarial.",
    imagen: economicaAdministrativa,
    areaParam: "Negocios y Administrativas",
    badges: ["Emprendimiento", "Alta empleabilidad"],
  },
  {
    nombre: "Tecnología e Ingeniería",
    descripcion:
      "Diseña soluciones innovadoras y optimiza procesos tecnológicos.",
    imagen: ingenieria,
    areaParam: "Tecnología e Ingeniería",
    badges: ["Innovación", "Enfoque práctico"],
  },
  {
    nombre: "Ciencias Sociales y Humanidades",
    descripcion:
      "Comprende el comportamiento humano y transforma el entorno social.",
    imagen: cienciasSociales,
    areaParam: "Ciencias Sociales y Humanidades",
    badges: ["Investigación", "Impacto social"],
  },
  {
    nombre: "Arquitectura y Diseño",
    descripcion:
      "Expresa tu creatividad a través de espacios y comunicación visual.",
    imagen: disenoArtes,
    areaParam: "Arquitectura y Diseño",
    badges: ["Creatividad", "Portafolio profesional"],
  },
];
---

<section id="custom-carousel" class="py-12 bg-white relative group/carousel">
  <div class="mb-8 px-6">
    <h3 class="text-3xl uppercase font-semibold text-center md:text-left">
      Explora nuestras áreas de estudio
    </h3>
  </div>

  <div class="overflow-hidden w-full relative">
    <div
      id="carousel-track"
      class="flex transition-transform duration-500 ease-out will-change-transform"
    >
      {
        areasAcademicas.map((area) => (
          <div class="carousel-slide flex-shrink-0 px-3 w-full sm:w-1/2 lg:w-1/3">
            <div class="relative group overflow-hidden rounded-lg shadow-lg h-[400px] md:h-80 cursor-pointer">
              <Image
                src={area.imagen}
                alt={area.nombre}
                width={600}
                height={400}
                format="webp"
                quality={80}
                class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110"
              />

              <div class="absolute inset-0 bg-gradient-to-t from-black/90 via-black/40 to-transparent flex flex-col justify-end p-6">
                <div class="flex gap-2 mb-3">
                  {area.badges.map((badge) => (
                    <span class="px-3 py-1 text-xs font-medium text-white bg-white/20 backdrop-blur-md rounded-full border border-white/30 shadow-lg">
                      {badge}
                    </span>
                  ))}
                </div>

                <a
                  href={`/oferta-academica/licenciaturas?area=${encodeURIComponent(area.areaParam)}`}
                  class="group/title"
                >
                  <h4 class="text-white text-xl font-bold leading-tight mb-2 group-hover/title:text-primary transition-colors">
                    {area.nombre}
                  </h4>
                </a>

                <p class="text-gray-200 text-sm font-light mb-4 opacity-90">
                  {area.descripcion}
                </p>

                <a
                  href={`/oferta-academica/licenciaturas?area=${encodeURIComponent(area.areaParam)}`}
                  class="text-white text-sm font-medium hover:text-primary transition-colors flex items-center gap-2 w-fit border-b border-white hover:border-primary pb-1"
                  aria-label={`Ver carreras de ${area.nombre}`}
                >
                  Ver carreras
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke-width="2"
                    stroke="currentColor"
                    class="w-4 h-4"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M13.5 4.5L21 12m0 0l-7.5 7.5M21 12H3"
                    />
                  </svg>
                </a>
              </div>
            </div>
          </div>
        ))
      }
    </div>
  </div>

  <div class="flex justify-start pl-8 items-center gap-4 mt-8">
    <button
      id="btn-prev"
      class="p-3 rounded-full border border-gray-300 hover:bg-primary hover:text-white transition-colors bg-white text-gray-700 shadow-sm"
      aria-label="Anterior"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
        stroke-width="1.5"
        stroke="currentColor"
        class="w-6 h-6"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          d="M15.75 19.5L8.25 12l7.5-7.5"></path>
      </svg>
    </button>

    <button
      id="btn-pause"
      class="p-3 rounded-full border border-gray-300 hover:bg-primary hover:text-white transition-colors bg-white text-gray-700 shadow-sm"
      aria-label="Pausar"
    >
      <svg
        id="icon-play"
        class="w-6 h-6 hidden"
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
        stroke-width="1.5"
        stroke="currentColor"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          d="M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.348a1.125 1.125 0 010 1.971l-11.54 6.347a1.125 1.125 0 01-1.667-.985V5.653z"
        ></path>
      </svg>
      <svg
        id="icon-pause"
        class="w-6 h-6"
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
        stroke-width="1.5"
        stroke="currentColor"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          d="M15.75 5.25v13.5m-7.5-13.5v13.5"></path>
      </svg>
    </button>

    <button
      id="btn-next"
      class="p-3 rounded-full border border-gray-300 hover:bg-primary hover:text-white transition-colors bg-white text-gray-700 shadow-sm"
      aria-label="Siguiente"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
        stroke-width="1.5"
        stroke="currentColor"
        class="w-6 h-6"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          d="M8.25 4.5l7.5 7.5-7.5 7.5"></path>
      </svg>
    </button>
  </div>
</section>
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const track = document.getElementById("carousel-track") as HTMLElement;
    const slides = Array.from(track.children) as HTMLElement[];
    const btnPrev = document.getElementById("btn-prev");
    const btnNext = document.getElementById("btn-next");
    const btnPause = document.getElementById("btn-pause");
    const iconPlay = document.getElementById("icon-play");
    const iconPause = document.getElementById("icon-pause");

    let currentIndex = 0;
    let slidesPerView = 3;
    let intervalId: any;
    let isPlaying = true;
    let isTransitioning = false;

    // --- Configuración Inicial y Clones para Loop Infinito ---
    const clonesCount = 3;

    const firstClones = slides
      .slice(0, clonesCount)
      .map((slide) => slide.cloneNode(true) as HTMLElement);
    const lastClones = slides
      .slice(-clonesCount)
      .map((slide) => slide.cloneNode(true) as HTMLElement);

    // Insertar clones
    firstClones.forEach((clone) => track.appendChild(clone));
    lastClones.reverse().forEach((clone) => track.prepend(clone));

    // Re-seleccionar todos los slides (originales + clones)
    const allSlides = Array.from(track.children) as HTMLElement[];

    // --- Funciones Core ---
    function updateDimensions() {
      const width = window.innerWidth;
      if (width < 640) slidesPerView = 1;
      else if (width < 1024) slidesPerView = 2;
      else slidesPerView = 3;

      updateCarouselPosition(false);
    }

    function getSlideWidth() {
      return allSlides[0].getBoundingClientRect().width;
    }

    function updateCarouselPosition(animate = true) {
      const slideWidth = getSlideWidth();
      const offset = (currentIndex + clonesCount) * slideWidth;

      if (!animate) {
        track.style.transition = "none";
      } else {
        track.style.transition = "transform 0.5s ease-out";
      }

      track.style.transform = `translateX(-${offset}px)`;
    }

    function handleTransitionEnd() {
      isTransitioning = false;
      const totalOriginalSlides = slides.length;

      if (currentIndex >= totalOriginalSlides) {
        track.style.transition = "none";
        currentIndex = 0;
        updateCarouselPosition(false);
      } else if (currentIndex < 0) {
        track.style.transition = "none";
        currentIndex = totalOriginalSlides - 1;
        updateCarouselPosition(false);
      }
    }

    function nextSlide() {
      if (isTransitioning) return;
      isTransitioning = true;
      currentIndex++;
      updateCarouselPosition(true);
    }

    function prevSlide() {
      if (isTransitioning) return;
      isTransitioning = true;
      currentIndex--;
      updateCarouselPosition(true);
    }

    // --- Lógica de Auto Play ---
    function startAutoPlay() {
      stopAutoPlay();
      intervalId = setInterval(() => {
        nextSlide();
      }, 3000);

      isPlaying = true;
      iconPlay?.classList.add("hidden");
      iconPause?.classList.remove("hidden");
    }

    function stopAutoPlay() {
      clearInterval(intervalId);
      isPlaying = false;
      iconPlay?.classList.remove("hidden");
      iconPause?.classList.add("hidden");
    }

    function togglePause() {
      if (isPlaying) stopAutoPlay();
      else startAutoPlay();
    }

    // --- Event Listeners ---
    btnNext?.addEventListener("click", () => {
      stopAutoPlay();
      nextSlide();
    });

    btnPrev?.addEventListener("click", () => {
      stopAutoPlay();
      prevSlide();
    });

    btnPause?.addEventListener("click", togglePause);

    track.addEventListener("transitionend", handleTransitionEnd);

    window.addEventListener("resize", () => {
      updateDimensions();
      setTimeout(updateDimensions, 100);
    });

    track.addEventListener("mouseenter", stopAutoPlay);
    track.addEventListener("mouseleave", () => {
      startAutoPlay();
    });

    // --- Inicialización ---
    updateDimensions();
    track.style.transition = "none";
    const slideWidth = getSlideWidth();
    track.style.transform = `translateX(-${clonesCount * slideWidth}px)`;

    startAutoPlay();
  });
</script>
